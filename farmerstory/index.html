<!doctype html>
<html lang="en" class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="https://html5-templates.com/" />
    <title>Farmer Suicide Viz</title>
    <meta name="description" content="Demo for Farmer Suicides Project">
    <!-- COPY ALL CODE BELOW -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
    <script>
        const maxCount = 160000;
        const profession = 0;
        const male = 1;
        const female = 2;
        const total = 3;
        const y = 4;
        const transgender = 5;
        const perc = 6;
        profLabels = ['House Wife', 'Farming/Agriculture', 'Daily Wage Earner', 'Total']
        yearLabels = ['1997-2002', '2003-2008', '2009-2013', '2014-2020']
        yearChoice = -1;
        profChoice = -1;

        function preload() {
            data = loadTable('farmersuicidedata.csv', 'csv', 'header');
            // console.log(data);
        }

        function setup() {
            //createCanvas
            var canvasDiv = document.getElementById('canvasForHTML');
            maxWidth = canvasDiv.offsetWidth;
            maxHeight = canvasDiv.offsetHeight;
            marginW = maxWidth/20;
            marginH = maxHeight/20;
            midW = maxWidth/2;
            midH = maxHeight/2;

            var canvas = createCanvas(maxWidth-20, maxHeight-20);
            canvas.parent('canvasForHTML');
            background(255);
            noLoop();

            createBackdrop();
            createDropdowns(leftLine, midH-7.5*marginH);
        }

        function draw() {
            background(255);
            createBackdrop();
            displayData();
        }

        function createBackdrop() {
            push();
            // chart
            bottomLine = midH+5*marginH;
            leftLine = 2*marginW;
            stroke(0);
            line(leftLine, midH-8*marginH, leftLine, bottomLine);
            maxBar = dist(leftLine, midH-8*marginH, leftLine, bottomLine);
            line(leftLine, bottomLine, maxWidth-marginW, bottomLine);
            // labels
            textSize(18);
            // markers
            textAlign(RIGHT, CENTER);
            for (i = 1; i < 16; i++) {
                line(leftLine-2, bottomLine-i*10000/maxCount*maxBar, leftLine+2, bottomLine-i*10000/maxCount*maxBar);
                text(i*10000, leftLine-5, bottomLine-i*10000/maxCount*maxBar);
            }
        }

        function createDropdowns(x, y) {
            //year dropdown
            yearDrop = createSelect().id('yearRange');
            yearDrop.position(x, y);
            yearDrop.option('Select a year range', -1);
            for(i = 0; i < yearLabels.length; i++) {
                yearDrop.option(yearLabels[i]);
            }

            //profession dropdown
            profDrop = createSelect().id('prof');
            profDrop.position(x+170, y);
            profDrop.option('Select a profession', -1);
            for(i = 0; i < profLabels.length; i++) {
                profDrop.option(profLabels[i]);
            }
            yearDrop.changed(updateChart);
            profDrop.changed(updateChart);
        }

        function updateChart() {
            profChoice = profDrop.value();
            yearChoice = yearDrop.value();
            // console.log(yearChoice, profChoice);

            minYear = yearChoice.split('-')[0];
            maxYear = yearChoice.split('-')[1];
            // console.log(minYear, maxYear);
            profFlags = [];
            if (profChoice == -1) {
                profFlags = [...Array(79).keys()];
            } else {
                for(i = 0; i < 79; i++) {
                    if (profChoice == data.getRow(i).getString(profession)) {
                        profFlags.push(i);
                    }
                }
            }
            // console.log(profFlags);
            displayFlags = [];
            if (yearChoice == -1) {
                displayFlags = profFlags;
            } else {
                for(i = 0; i < profFlags.length; i++) {
                    // console.log(data.getRow(profFlags[i]));
                    if (minYear <= data.getRow(profFlags[i]).getString(y) & data.getRow(profFlags[i]).getString(y) <= maxYear) {
                        displayFlags.push(profFlags[i]);
                    }
                }
            }
            // console.log(displayFlags);
            draw();
        }

        function displayData() {
            if (yearChoice == -1 | profChoice == -1)
                return
            // console.log(displayFlags);
            textAlign(CENTER, BOTTOM);
            noStroke();
            start = leftLine + marginW;
            colWidth = (maxWidth-leftLine-3*marginW)/13;
            textSize(18);
            for (i = 0; i < displayFlags.length; i++) {
                stat = data.getRow(displayFlags[i]).getString(total);
                colLength = stat/maxCount * maxBar;
                // console.log(stat, colLength);
                fill(221, 181, 80);
                rect(start+2*i*colWidth, bottomLine-1, colWidth, -1*colLength);
                fill(0)
                text(stat, start+(1+4*i)*colWidth/2, bottomLine-colLength-10);
            }

            for (i = 0; i < displayFlags.length; i++) {
                stat = data.getRow(displayFlags[i]).getString(female);
                colLength = stat/maxCount * maxBar;
                // console.log(stat, colLength);
                fill(55, 120, 184);
                rect(start+2*i*colWidth, bottomLine-1, colWidth, -1*colLength);
                fill(0);
                text(stat, start+(1+4*i)*colWidth/2, bottomLine-10);
            }

            for (i = 0; i < displayFlags.length; i++) {
                textSize(20);
                textAlign(CENTER, TOP);
                text(data.getRow(displayFlags[i]).getString(y), start+(1+4*i)*colWidth/2, midH+5.5*marginH);
            }
        }
    </script>
    <!-- COPY UNTIL ABOVE -->
</head>

<body>
    <h1>Farmer Suicide among Women</h1>
    <!-- ADD LINE BELOW AT CHART LOCATION -->
    <div style="height:500px;" id="canvasForHTML"></div>
    <!-- ONLY LINE ABOVE -->
    <p> Data Details: </p>
    <ol>
        <li> The visualization here plots (selected) profession-wise suicide data across years. The yellow bars are the totals across all genders for that profession, while the blue bars are the count of the women. Legend will be added.
        <li> There is a total of 24 years worth of data available: 1997-2020. Data from 1996 is on state-level, so if there is time, I will try to add it, giving us 25 years.
        <li> I have separated the above into sections of 6 years for better readability.
        <li> However, years 2014-2020 (7 years) have data for Daily Wage Earners, while the other 17 years do not. Thus, these 7 years have been clubbed together, even though they are more than 6.
        <li> Consequently, years 2009-2013 have only 5 years clubbed together.
        <li> The option of 'Daily Wage Earners' shows up for the other years, but no chart is displayed. I am working on greying out this option for the other years.
    </ol>
    <p> Code Details: </p>
    <ol>
        <li> Please visit <a href="https://github.com/pankhurikumar23/pankhurikumar23.github.io/tree/master/farmerstory">https://github.com/pankhurikumar23/pankhurikumar23.github.io/tree/master/farmerstory</a> for the code
        <li> The CSV file will need to be stored in the same folder as the story's HTML file.
        <li> Lines that need to be copied are marked in file 'index.html' - namely, lines 11-164, and line 171.
        <li> Lines 11-164 can be added in the "head" portion of the HTML, while line 171 will be added to the "body" in HTML code where we want the chart to appear.
        <li> In line 171, changing the size of the element will allow the size of the chart to change.
    </ol>
</body>
</html>